---
site: "bookdown::bookdown_site"
output:
  bookdown::gitbook:
    lib_dir: "book_output"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, message = F)

library(plotly)
library(ggplot2)
library(crosstalk)

layout_ggplotly <- function(gg, x = -0.02, y = -0.08){
  # The 1 and 2 goes into the list that contains the options for the x and y axis labels respectively
  gg[['x']][['layout']][['annotations']][[1]][['y']] <- x
  gg[['x']][['layout']][['annotations']][[2]][['x']] <- y
  gg
}
```

# R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:

```{r cars}

nPatients <- 50
nVisits <- 10

d <- data.frame(
  time = rep(1980:2019,4),
  value = rnorm(160),
  var = rep(c("var1","var2", "var3","var4"), each = 40),
  var2 = rep(c("var1","var2", "var1","var2"), each = 40))

gp <- ggplot(data = d) +
  geom_line(aes(x = time, y = value, color = var)) +
  facet_grid(var2~.) +
  theme( legend.title = element_blank())

gp <- ggplotly(gp) %>%
    add_annotations(text="Generic\n plot", xref="paper", yref="paper",
                  x=1.1, xanchor="left",
                  y=0.95, yanchor="bottom",    # Same y as legend below
                  legendtitle=TRUE, showarrow=FALSE) %>% 
  	layout( legend = list(yanchor = "top", y = 0.95, x = 1.1))


layout_ggplotly(gp, x = -0.05, y = -0.05)
```

Here's some more text

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
