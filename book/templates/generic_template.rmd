---
title:
    | 
    | Ecosystem Context for Stock Assessments:
    | {{COMMON_NAME}}
date: "`r format(Sys.time(), '%B %d, %Y')`"
always_allow_html: yes
site: "bookdown::bookdown_site"
output:
  bookdown::gitbook:
    lib_dir: "book_output"
---

```{r setup, include = FALSE}
## Load packages
# library(ecsa)
library(dplyr)
library(ggplot2)
# library(gridExtra)
library(DT)
library(jpeg)
library(patchwork)
library(ggiraph)
library(ggthemes)
library(cowplot)

# Load in survey data, right now it is only for summer flounder
# load("data/df_survdat.rda")
# colnames(survdat)
# colnames(df_survdat)

# load("data/Survdat.RData")
# tt <- survdat

## Read in stock area vectors
# all_stock_area2 <- read.csv("data/seasonal_stock_strata.csv")

## Read in stock area vectors
all_stock_area <- read.csv("data/stock_list.csv", stringsAsFactors = FALSE)


## Put all mustaches here
stock_code <- "{{SPECIES_CODE}}"
common_name <- "{{COMMON_NAME}}"
cc_name <- "{{CC_NAME}}"
svspp <- "{{SVSPP}}"
gg_int <- as.logical("{{INTERACTIVE}}")

source("R/map_strata.R")
source("R/get_strata.R")

strata_spring <- all_stock_area %>% 
  dplyr::filter(species_code == stock_code,
                season == "spring") %>% 
  dplyr::pull(strat)

strata_fall <- all_stock_area %>% 
  dplyr::filter(species_code == stock_code,
         season == "fall") %>% 
  dplyr::pull(strat)

label <- function(variable,value){
  return(facet_names[value])
}

```


## Overview 

### Introduction
This report provides contextual ecosystem information for {{COMMON_NAME}} (*{{SCI_NAME}}*) on the Northeast U.S. Continental Shelf. Data extractions for spring and fall are confined to the {{COMMON_NAME}} stock area based on respective survey strata sets. The information is intended to span a range of potential factors affecting the productivity and distribution of {{COMMON_NAME}}, including: surface and bottom temperature and salinity, chlorophyll concentrations, indices of habitat, diet composition, and abundance of key zooplankton prey of larval {{COMMON_NAME}}. These factors can be used to qualitatively inform the interpretation of population status and/or quantitatively to improve model responsiveness to ecosystem factors. The range and complexity of ecosystem data makes it unlikely to find the most relevant and comprehensive factor variables with a first evaluation; this process will require an iterative approach of evaluation and feedback. Additional indices can be included to address the needs of the working group.

#### Summary

* Add summary point 
* Add summary point 
* Add summary point 

### Strata definition
```{r strata-map, eval = TRUE, echo = FALSE, fig.cap= "Strata map for {{COMMON_NAME}} (*{{SCI_NAME}}*) on the NE shelf", message = FALSE, warning = FALSE, fig.align='center'}

map_strata(common_name = common_name, spring_strata = spring_strata,
           fall_strata = fall_strata, overwrite = FALSE, save_plot = FALSE)
```



_Last updated on `r format(Sys.Date(), format = "%B %e %Y")`._
